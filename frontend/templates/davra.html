{% extends 'base.html' %}


{% load static %}
{% block content %}



<body class="bg-gradient-to-br from-orange-100 via-white to-orange-200 
dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 
min-h-screen flex flex-col transition-colors duration-500">


<!-- HEADER -->
<header class="p-5 flex justify-between items-center bg-white/70 backdrop-blur-xl shadow-lg dark:bg-gray-900/70">
  <h1 class="text-2xl font-extrabold text-orange-500"> Daily Plan</h1>

  <div class="flex items-center gap-4">
    <div id="clock" class="text-sm font-semibold"></div>
    
  </div>
</header>

<!-- ADD FORM -->
<section class="p-5">
  <div class="bg-white/80 dark:bg-gray-800 backdrop-blur-xl rounded-3xl shadow-2xl p-5 border border-orange-200">

    <div class="grid md:grid-cols-5 gap-3">
      <input id="bookName" placeholder="Kitob nomi"
        class="px-3 py-2 rounded-xl border focus:ring-2 focus:ring-orange-400 outline-none dark:bg-gray-700">

      <input id="pages" type="number" placeholder="Varaq"
        class="px-3 py-2 rounded-xl border focus:ring-2 focus:ring-orange-400 outline-none dark:bg-gray-700">

      <input id="hours" type="number" step="0.5" placeholder="Soat"
        class="px-3 py-2 rounded-xl border focus:ring-2 focus:ring-orange-400 outline-none dark:bg-gray-700">

      <select id="time"
        class="px-3 py-2 rounded-xl border focus:ring-2 focus:ring-orange-400 outline-none dark:bg-gray-700">
        <option>Ertalab</option>
        <option>Kechqurun</option>
        <option>Bo‘sh vaqtda</option>
      </select>

      <button onclick="addTask()"
        class="bg-gradient-to-r h-[40px] from-orange-400 to-orange-500 text-white rounded-xl font-semibold hover:scale-105 transition">
        Qo‘shish
      </button>
    </div>

  </div>
</section>

<!-- TASK LIST -->
<section class="flex-1 p-5 space-y-4" id="taskList"></section>

<!-- STATISTICS -->
<section class="p-5">
  <div class="bg-white/80 dark:bg-gray-800 backdrop-blur-xl rounded-3xl shadow-2xl p-6 border border-orange-200">

    <div class="grid grid-cols-4 gap-4 text-center">

      <div>
        <div id="total" class="text-xl font-bold text-orange-600">0</div>
        <div class="text-xs">Jami</div>
      </div>

      <div>
        <div id="done" class="text-xl font-bold text-orange-600">0</div>
        <div class="text-xs">Bajarildi</div>
      </div>

      <div>
        <div id="totalPages" class="text-xl font-bold text-orange-600">0</div>
        <div class="text-xs">Varoq</div>
      </div>

      <div>
        <div id="percent" class="text-xl font-bold text-orange-600">0%</div>
        <div class="text-xs">Progress</div>
      </div>

    </div>

    <!-- CIRCLE -->
    <div class="flex justify-center mt-6">
      <div class="relative w-28 h-28">
        <svg class="w-28 h-28 transform -rotate-90">
          <circle cx="56" cy="56" r="50" stroke="#eee" stroke-width="8" fill="none"/>
          <circle id="circleProgress"
            cx="56" cy="56" r="50"
            stroke="orange"
            stroke-width="8"
            fill="none"
            stroke-dasharray="314"
            stroke-dashoffset="314"
            stroke-linecap="round"/>
        </svg>
        <div id="circleText"
          class="absolute inset-0 flex items-center justify-center text-lg font-bold text-orange-600">
          0%
        </div>
      </div>
    </div>

  </div>
</section>

<script>

// LOCAL STORAGE INIT
let tasks = JSON.parse(localStorage.getItem("tasks")) || [];
let lastDate = localStorage.getItem("lastDate");

// AUTO RESET AT 00:00
const today = new Date().toDateString();
if(lastDate !== today){
  tasks = [];
  localStorage.setItem("tasks",JSON.stringify(tasks));
  localStorage.setItem("lastDate",today);
}

// CLOCK
function updateClock(){
  const now = new Date();
  clock.innerText =
    now.getHours().toString().padStart(2,'0') + ":" +
    now.getMinutes().toString().padStart(2,'0') + ":" +
    now.getSeconds().toString().padStart(2,'0');
}
setInterval(updateClock,1000);
updateClock();


// ADD TASK
function addTask(){
  if(!bookName.value || !pages.value || !hours.value) return;

  tasks.push({
    name:bookName.value,
    pages:parseInt(pages.value),
    hours:hours.value,
    time:time.value,
    done:false
  });

  save();
  render();

  bookName.value="";
  pages.value="";
  hours.value="";
}

// SAVE
function save(){
  localStorage.setItem("tasks",JSON.stringify(tasks));
}

// RENDER
function render(){
  taskList.innerHTML="";
  tasks.forEach((task,index)=>{
    const div = document.createElement("div");
    div.className="bg-white/80 dark:bg-gray-800 backdrop-blur-xl rounded-3xl shadow-xl p-4 flex items-start gap-4 border border-orange-200 transition hover:scale-[1.02]";

    div.innerHTML=`
      <input type="checkbox" ${task.done?"checked":""} 
        onchange="toggleDone(${index})"
        class="w-6 h-6 accent-orange-500 mt-1">
      <div class="flex-1">
        <h3 class="font-bold">${task.name}</h3>
        <div class="text-sm mt-1">
          ${task.pages} varoq • ${task.hours} soat • ${task.time}
        </div>
        <div class="w-full bg-gray-200 h-2 rounded-full mt-3">
          <div class="bg-gradient-to-r from-orange-400 to-orange-500 h-2 rounded-full transition-all duration-500"
            style="width:${task.done?100:0}%"></div>
        </div>
      </div>
    `;

    if(task.done) div.classList.add("opacity-60","line-through");

    taskList.appendChild(div);
  });

  updateStats();
}

// TOGGLE DONE
function toggleDone(i){
  tasks[i].done=!tasks[i].done;
  save();
  render();
}

// STATS
function updateStats(){
  let totalT=tasks.length;
  let doneT=tasks.filter(t=>t.done).length;
  let totalPg=tasks.reduce((a,b)=>a+b.pages,0);
  let percentVal= totalT?Math.round((doneT/totalT)*100):0;

  total.innerText=totalT;
  done.innerText=doneT;
  totalPages.innerText=totalPg;
  percent.innerText=percentVal+"%";

  const offset=314-(314*percentVal/100);
  circleProgress.style.strokeDashoffset=offset;
  circleText.innerText=percentVal+"%";
}

render();

</script>

</body>



{% endblock %}